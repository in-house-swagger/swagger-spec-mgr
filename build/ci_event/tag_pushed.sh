#!/bin/bash
#set -eux
#===================================================================================================
#
# CI Event - Tag Pushed
#
#===================================================================================================
#---------------------------------------------------------------------------------------------------
# env
#---------------------------------------------------------------------------------------------------
dir_script="$(dirname $0)"
cd "$(cd ${dir_script}; cd ../..; pwd)" || exit 1

readonly DIR_BASE="$(pwd)"
. "${DIR_BASE}/build/env.properties"
. "${DIR_BUILD_LIB}/common.sh"


#---------------------------------------------------------------------------------------------------
# main
#---------------------------------------------------------------------------------------------------
echo "$(basename $0)"

echo ""
echo "--------------------------------------------------"
echo "build stage"
echo "--------------------------------------------------"
${DIR_BUILD}/product/build.sh
exit_on_fail "product/build" $?

echo ""
echo "--------------------------------------------------"
echo "publish stage"
echo "--------------------------------------------------"
${DIR_BUILD}/product/publish.sh
exit_on_fail "product/publish" $?

${DIR_BUILD}/docs/publish.sh
exit_on_fail "docs/publish" $?

echo ""
echo "--------------------------------------------------"
echo "post release"
echo "--------------------------------------------------"
${DIR_BUILD}/release/post.sh
exit_on_fail "release/post" $?


#---------------------------------------------------------------------------------------------------
# teardown
#---------------------------------------------------------------------------------------------------
echo ""
echo "$(basename $0) success."
exit 0
